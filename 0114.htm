<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Äî –°–∏—Å—Ç–µ–º–∞ –∞—Ä–µ–Ω–¥—ã —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- –æ–±—â–∏–π —Å—Ç–∏–ª—å -->
  <link rel="stylesheet" href="styles.css" />

  <!-- –ª–æ–∫–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ + –≥—Ä–∞–Ω–∏—Ü—ã —Ç–∞–±–ª–∏—Ü -->
  <style>
    table { width: 100%; border-collapse: collapse; margin: 12px 0; }
    th, td { border: 1px solid #cfcfcf; padding: 6px 8px; vertical-align: top; }
    th { background: #f7f7f9; text-align: left; }
    code, pre code { background: #f6f8fa; border-radius: 4px; }
    pre { overflow: auto; padding: 10px; background: #f6f8fa; border: 1px solid #e5e7eb; border-radius: 6px; }
    nav a { margin-right: 10px; }
    .subtitle { color:#666; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .filename { margin: 8px 0 4px; font-weight: 600; }
  </style>

  <!-- Mermaid (–Ω–∞ –±—É–¥—É—â–µ–µ ‚Äî –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç–µ —Å—Ö–µ–º—ã) -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true, securityLevel: 'loose' });</script>
</head>
<body>
  <div class="wrap">
    <header>
            <nav class="global-nav">
      <a href="index.htm">üìö –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="012.htm">2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</a>
      <a href="013.htm">3. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
      <a href="0114.htm">4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è</a>
      <a href="0115.htm">5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
      <a href="0116.htm">6. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞</a>
    </nav>
      <h1>4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞</h1>
      <div class="subtitle">–£—á–µ–±–Ω—ã–π –∫–µ–π—Å: ¬´–°–∏—Å—Ç–µ–º–∞ –∞—Ä–µ–Ω–¥—ã —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è¬ª (.NET 6/8, C#)</div>
      <nav>
        <a href="#structure">4.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</a>
        <a href="#domain">4.2 –ú–æ–¥–µ–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏</a>
        <a href="#storage">4.3 –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏</a>
        <a href="#calc">4.4 –†–∞—Å—á—ë—Ç —Ç–∞—Ä–∏—Ñ–æ–≤</a>
        <a href="#service">4.5 –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞—Ä–µ–Ω–¥—ã</a>
        <a href="#ui">4.6 –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</a>
        <a href="#seed">4.7 –î–∞–Ω–Ω—ã–µ (—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)</a>
        <a href="#ux">4.8 –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</a>
        <a href="#quality">4.9 –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞</a>
        <a href="#demo">4.10 –ü—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a>
      </nav>
    </header>

    <!-- 4.1 -->
    <section id="structure">
      <h2>4.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Console App)</h2>

      <pre class="mono"><code>rental-sport-inventory/
‚îú‚îÄ src/
‚îÇ  ‚îú‚îÄ RentalApp/
‚îÇ  ‚îÇ  ‚îú‚îÄ Program.cs
‚îÇ  ‚îÇ  ‚îú‚îÄ AppConfig.cs
‚îÇ  ‚îÇ  ‚îú‚îÄ Domain/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Customer.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ InventoryItem.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Tariff.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Rental.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ MaintenanceRecord.cs
‚îÇ  ‚îÇ  ‚îú‚îÄ Services/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ DataStorage.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ TariffCalculator.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ RentalService.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ MaintenanceService.cs
‚îÇ  ‚îÇ  ‚îú‚îÄ Utils/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Guard.cs
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ ConsoleUi.cs
‚îÇ  ‚îÇ  ‚îî‚îÄ RentalApp.csproj
‚îÇ  ‚îî‚îÄ README.md
‚îú‚îÄ data/
‚îÇ  ‚îú‚îÄ customers.json
‚îÇ  ‚îú‚îÄ items.json
‚îÇ  ‚îú‚îÄ tariffs.json
‚îÇ  ‚îú‚îÄ rentals.json
‚îÇ  ‚îú‚îÄ maintenance.json
‚îî‚îÄ .gitignore</code></pre>

      <table>
        <thead>
          <tr><th>–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</th><th>–ó–∞–ø—É—Å–∫</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ .NET (<code>System.Text.Json</code>)</td>
            <td><code>dotnet run --project src/RentalApp</code></td>
          </tr>
        </tbody>
      </table>

      <div class="filename">RentalApp.csproj</div>
      <pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;</code></pre>
    </section>

    <!-- 4.2 -->
    <section id="domain">
      <h2>4.2. –ú–æ–¥–µ–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (Domain)</h2>

      <div class="filename">Customer.cs</div>
      <pre><code class="language-csharp">namespace RentalApp.Domain;

public sealed class Customer
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public string FullName { get; set; } = "";
    public string Phone { get; set; } = "";
    public string? DocumentId { get; set; }
}</code></pre>

      <div class="filename">InventoryItem.cs</div>
      <pre><code class="language-csharp">namespace RentalApp.Domain;

public sealed class InventoryItem
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public string InvNumber { get; set; } = "";            // e.g. INV-0001
    public string Category { get; set; } = "Bicycle";      // Bicycle/Skates/Skis...
    public string Condition { get; set; } = "Good";
    public string Status { get; private set; } = "available"; // available/rented/maintenance
    public DateTime? LastServiceAt { get; set; }

    public void ChangeStatus(string newStatus)
    {
        if (newStatus is not ("available" or "rented" or "maintenance"))
            throw new ArgumentOutOfRangeException(nameof(newStatus), "Unknown status");
        Status = newStatus;
    }
}</code></pre>

      <div class="filename">Tariff.cs</div>
      <pre><code class="language-csharp">namespace RentalApp.Domain;

public sealed class Tariff
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public string Name { get; set; } = "–ß–∞—Å–æ–≤–æ–π";
    public string Mode { get; set; } = "hour";            // hour/day/package
    public decimal Rate { get; set; }                     // –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
    public string RoundRule { get; set; } = "ceil_30min"; // –ø—Ä–∞–≤–∏–ª–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
}</code></pre>

      <div class="filename">Rental.cs</div>
      <pre><code class="language-csharp">namespace RentalApp.Domain;

public sealed class Rental
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public Guid CustomerId { get; init; }
    public Guid ItemId { get; init; }
    public Guid TariffId { get; init; }
    public DateTime StartAt { get; init; } = DateTime.Now;
    public DateTime? EndAt { get; private set; }
    public decimal BaseAmount { get; private set; }
    public decimal Discount { get; set; }
    public decimal Penalty { get; set; }
    public decimal Total { get; private set; }
    public string Status { get; private set; } = "open"; // open/closed

    public void Close(DateTime endAt, decimal baseAmount, decimal discount, decimal penalty)
    {
        if (Status == "closed") throw new InvalidOperationException("Rental already closed");
        EndAt = endAt;
        BaseAmount = baseAmount;
        Discount = discount;
        Penalty = penalty;
        Total = Math.Max(0, baseAmount - discount + penalty);
        Status = "closed";
    }
}</code></pre>

      <div class="filename">MaintenanceRecord.cs</div>
      <pre><code class="language-csharp">namespace RentalApp.Domain;

public sealed class MaintenanceRecord
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public Guid ItemId { get; init; }
    public DateTime Date { get; init; } = DateTime.Today;
    public string Work { get; set; } = "";
    public string? Note { get; set; }
}</code></pre>
    </section>

    <!-- 4.3 -->
    <section id="storage">
      <h2>4.3. –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (DataStorage)</h2>
      <p><em>DataStorage.cs</em> ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π JSON (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª).</p>
      <pre><code class="language-csharp">using System.Text.Json;
using System.Text.Json.Serialization;
using RentalApp.Domain;

namespace RentalApp.Services;

public sealed class DataStorage
{
    private readonly string _dir;
    private readonly JsonSerializerOptions _json = new()
    {
        WriteIndented = true,
        DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull
    };

    public List&lt;Customer&gt; Customers { get; private set; } = new();
    public List&lt;InventoryItem&gt; Items { get; private set; } = new();
    public List&lt;Tariff&gt; Tariffs { get; private set; } = new();
    public List&lt;Rental&gt; Rentals { get; private set; } = new();
    public List&lt;MaintenanceRecord&gt; Maintenances { get; private set; } = new();

    public DataStorage(string dataDirectory)
    {
        _dir = dataDirectory;
        Directory.CreateDirectory(_dir);
    }

    public void LoadAll()
    {
        Customers    = Load&lt;List&lt;Customer&gt;&gt;("customers.json")    ?? new();
        Items        = Load&lt;List&lt;InventoryItem&gt;&gt;("items.json")   ?? new();
        Tariffs      = Load&lt;List&lt;Tariff&gt;&gt;("tariffs.json")        ?? new();
        Rentals      = Load&lt;List&lt;Rental&gt;&gt;("rentals.json")        ?? new();
        Maintenances = Load&lt;List&lt;MaintenanceRecord&gt;&gt;("maintenance.json") ?? new();
    }

    public void SaveAll()
    {
        Save("customers.json", Customers);
        Save("items.json", Items);
        Save("tariffs.json", Tariffs);
        Save("rentals.json", Rentals);
        Save("maintenance.json", Maintenances);
    }

    private T? Load&lt;T&gt;(string file)
    {
        var path = Path.Combine(_dir, file);
        if (!File.Exists(path)) return default;
        var json = File.ReadAllText(path);
        return JsonSerializer.Deserialize&lt;T&gt;(json, _json);
    }

    private void Save&lt;T&gt;(string file, T data)
    {
        var path = Path.Combine(_dir, file);
        var tmp  = path + ".tmp";
        var json = JsonSerializer.Serialize(data, _json);
        File.WriteAllText(tmp, json);
        File.Copy(tmp, path, overwrite: true);
        File.Delete(tmp);
    }
}</code></pre>
    </section>

    <!-- 4.4 -->
    <section id="calc">
      <h2>4.4. –†–∞—Å—á—ë—Ç —Ç–∞—Ä–∏—Ñ–æ–≤ (TariffCalculator)</h2>
      <p>–ü—Ä–∞–≤–∏–ª–æ <code>ceil_30min</code>: –µ—Å–ª–∏ –æ—Å—Ç–∞—Ç–æ–∫ –º–∏–Ω—É—Ç ‚â• 30 ‚Äî –æ–∫—Ä—É–≥–ª—è—Ç—å –≤–≤–µ—Ä—Ö –¥–æ —á–∞—Å–∞. –î–ª—è <code>Mode=day</code> ‚Äî –∫—Ä–∞—Ç–Ω–æ —Å—É—Ç–∫–∞–º, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö –ø—Ä–∏ –ª—é–±–æ–º –Ω–µ–ø–æ–ª–Ω–æ–º –¥–Ω–µ.</p>
      <pre><code class="language-csharp">using RentalApp.Domain;

namespace RentalApp.Services;

public sealed class TariffCalculator
{
    public decimal Calculate(Tariff t, DateTime start, DateTime end)
    {
        if (end &lt;= start) return 0m;

        var span = end - start;

        return t.Mode switch
        {
            "hour" => CalcHour(t, span),
            "day"  => CalcDay(t, span),
            "package" => t.Rate, // —É–ø—Ä–æ—â—ë–Ω–Ω–æ: —Ñ–∏–∫—Å
            _ => throw new ArgumentOutOfRangeException(nameof(t.Mode))
        };
    }

    private static decimal CalcHour(Tariff t, TimeSpan span)
    {
        var hours = (int)span.TotalHours;
        var minutes = span.Minutes;

        var billableHours = minutes >= 30 ? hours + 1 : hours;
        if (billableHours == 0) billableHours = 1; // –º–∏–Ω–∏–º—É–º 1 —á–∞—Å

        return billableHours * t.Rate;
    }

    private static decimal CalcDay(Tariff t, TimeSpan span)
    {
        var days = (int)Math.Ceiling(span.TotalDays);
        if (days == 0) days = 1;
        return days * t.Rate;
    }
}</code></pre>
    </section>

    <!-- 4.5 -->
    <section id="service">
      <h2>4.5. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞—Ä–µ–Ω–¥—ã (RentalService)</h2>
      <pre><code class="language-csharp">using RentalApp.Domain;

namespace RentalApp.Services;

public sealed class RentalService
{
    private readonly DataStorage _db;
    private readonly TariffCalculator _calc;

    public RentalService(DataStorage db, TariffCalculator calc)
    {
        _db = db;
        _calc = calc;
    }

    public Rental OpenRental(Guid customerId, Guid itemId, Guid tariffId, DateTime? startAt = null)
    {
        var customer = _db.Customers.FirstOrDefault(x => x.Id == customerId)
            ?? throw new InvalidOperationException("–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
        var item = _db.Items.FirstOrDefault(x => x.Id == itemId)
            ?? throw new InvalidOperationException("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
        var tariff = _db.Tariffs.FirstOrDefault(x => x.Id == tariffId)
            ?? throw new InvalidOperationException("–¢–∞—Ä–∏—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω");

        if (item.Status != "available")
            throw new InvalidOperationException("–ï–¥–∏–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–¥–∞—á–∏");

        item.ChangeStatus("rented");

        var rental = new Rental
        {
            CustomerId = customer.Id,
            ItemId = item.Id,
            TariffId = tariff.Id,
            // StartAt –∑–∞–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, –Ω–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
        };

        if (startAt.HasValue)
        {
            // —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –Ω–µ –º–µ–Ω—è–µ–º, –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π
            rental = new Rental
            {
                CustomerId = customer.Id,
                ItemId = item.Id,
                TariffId = tariff.Id,
                // —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç
                // (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–∏–º StartAt –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ª–∏–±–æ –¥–æ–±–∞–≤—å—Ç–µ —Å–µ—Ç—Ç–µ—Ä)
            };
        }

        _db.Rentals.Add(rental);
        _db.SaveAll();
        return rental;
    }

    public Rental CloseRental(Guid rentalId, DateTime endAt, decimal discount = 0, decimal penalty = 0)
    {
        var rental = _db.Rentals.FirstOrDefault(x => x.Id == rentalId)
            ?? throw new InvalidOperationException("–î–æ–≥–æ–≤–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω");
        if (rental.Status == "closed")
            throw new InvalidOperationException("–î–æ–≥–æ–≤–æ—Ä —É–∂–µ –∑–∞–∫—Ä—ã—Ç");

        var item = _db.Items.First(x => x.Id == rental.ItemId);
        var tariff = _db.Tariffs.First(x => x.Id == rental.TariffId);

        var baseAmount = _calc.Calculate(tariff, rental.StartAt, endAt);
        rental.Close(endAt, baseAmount, discount, penalty);

        item.ChangeStatus("available");
        _db.SaveAll();
        return rental;
    }

    public IEnumerable&lt;Rental&gt; GetActiveRentals() => _db.Rentals.Where(r => r.Status == "open");
}</code></pre>
    </section>

    <!-- 4.6 -->
    <section id="ui">
      <h2>4.6. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (ConsoleUi + Program)</h2>

      <div class="filename">Utils/ConsoleUi.cs</div>
      <pre><code class="language-csharp">using RentalApp.Domain;
using RentalApp.Services;

namespace RentalApp.Utils;

public sealed class ConsoleUi
{
    private readonly DataStorage _db;
    private readonly RentalService _service;

    public ConsoleUi(DataStorage db, RentalService service)
    {
        _db = db;
        _service = service;
    }

    public void Run()
    {
        while (true)
        {
            Console.WriteLine("\n=== –ü—É–Ω–∫—Ç –ø—Ä–æ–∫–∞—Ç–∞ ===");
            Console.WriteLine("1. –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è");
            Console.WriteLine("2. –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤");
            Console.WriteLine("3. –û—Ç–∫—Ä—ã—Ç—å –∞—Ä–µ–Ω–¥—É");
            Console.WriteLine("4. –ó–∞–∫—Ä—ã—Ç—å –∞—Ä–µ–Ω–¥—É");
            Console.WriteLine("5. –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã");
            Console.WriteLine("0. –í—ã—Ö–æ–¥");
            Console.Write("–í—ã–±–æ—Ä: ");
            var choice = Console.ReadLine();

            try
            {
                switch (choice)
                {
                    case "1": ShowItems(); break;
                    case "2": ShowCustomers(); break;
                    case "3": OpenRental(); break;
                    case "4": CloseRental(); break;
                    case "5": ShowActive(); break;
                    case "0": return;
                    default: Console.WriteLine("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞."); break;
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"–û—à–∏–±–∫–∞: {ex.Message}");
            }
        }
    }

    private void ShowItems()
    {
        foreach (var i in _db.Items)
            Console.WriteLine($"{i.InvNumber} [{i.Category}] ‚Äî {i.Status}");
    }

    private void ShowCustomers()
    {
        foreach (var c in _db.Customers)
            Console.WriteLine($"{c.FullName} ‚Äî {c.Phone}");
    }

    private void OpenRental()
    {
        var cust = _db.Customers.FirstOrDefault() ?? throw new Exception("–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤");
        var item = _db.Items.FirstOrDefault(x => x.Status == "available") ?? throw new Exception("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è");
        var tariff = _db.Tariffs.FirstOrDefault() ?? throw new Exception("–ù–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤");

        var r = _service.OpenRental(cust.Id, item.Id, tariff.Id);
        Console.WriteLine($"–ê—Ä–µ–Ω–¥–∞ –æ—Ç–∫—Ä—ã—Ç–∞: {r.Id}, –ø—Ä–µ–¥–º–µ—Ç {item.InvNumber}, –∫–ª–∏–µ–Ω—Ç {cust.FullName}");
    }

    private void CloseRental()
    {
        var open = _service.GetActiveRentals().FirstOrDefault() ?? throw new Exception("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—Ä–µ–Ω–¥");
        var closed = _service.CloseRental(open.Id, DateTime.Now.AddHours(1).AddMinutes(35)); // –ø—Ä–∏–º–µ—Ä: 1—á35–º
        Console.WriteLine($"–ê—Ä–µ–Ω–¥–∞ –∑–∞–∫—Ä—ã—Ç–∞: {closed.Id}, —Å—É–º–º–∞ {closed.Total:F2}");
    }

    private void ShowActive()
    {
        var list = _service.GetActiveRentals().ToList();
        if (list.Count == 0) { Console.WriteLine("–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞—Ä–µ–Ω–¥ –Ω–µ—Ç."); return; }
        foreach (var r in list) Console.WriteLine($"ID={r.Id} start={r.StartAt}");
    }
}</code></pre>

      <div class="filename">Program.cs</div>
      <pre><code class="language-csharp">using RentalApp.Services;
using RentalApp.Utils;

var dataDir = Path.Combine(AppContext.BaseDirectory, "..", "..", "..", "..", "data");
var db = new DataStorage(dataDir);
db.LoadAll();

// –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–æ–∑–¥–∞–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
SeedIfEmpty(db);

var calc = new TariffCalculator();
var rentalService = new RentalService(db, calc);

var ui = new ConsoleUi(db, rentalService);
ui.Run();

static void SeedIfEmpty(DataStorage db)
{
    if (!db.Customers.Any())
    {
        db.Customers.Add(new() { FullName = "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω", Phone = "+7-900-000-00-01", DocumentId = "AB123456" });
        db.Customers.Add(new() { FullName = "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä", Phone = "+7-900-000-00-02" });
    }
    if (!db.Items.Any())
    {
        db.Items.Add(new() { InvNumber = "INV-0001", Category = "Bicycle" });
        db.Items.Add(new() { InvNumber = "INV-0002", Category = "Skates" });
    }
    if (!db.Tariffs.Any())
    {
        db.Tariffs.Add(new() { Name = "–ß–∞—Å–æ–≤–æ–π", Mode = "hour", Rate = 300m, RoundRule = "ceil_30min" });
        db.Tariffs.Add(new() { Name = "–°—É—Ç–æ—á–Ω—ã–π", Mode = "day", Rate = 1200m });
    }
    db.SaveAll();
}</code></pre>
    </section>

    <!-- 4.7 -->
    <section id="seed">
      <h2>4.7. –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (<span class="mono">data/*.json</span>)</h2>

      <div class="filename">customers.json (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)</div>
      <pre><code class="language-json">[
  { "Id": "d2f3a1c3-0000-0000-0000-000000000001", "FullName": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω", "Phone": "+7-900-000-00-01", "DocumentId": "AB123456" },
  { "Id": "d2f3a1c3-0000-0000-0000-000000000002", "FullName": "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä", "Phone": "+7-900-000-00-02" }
]</code></pre>

      <div class="filename">items.json (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)</div>
      <pre><code class="language-json">[
  { "Id": "e1e1e1e1-0000-0000-0000-000000000001", "InvNumber": "INV-0001", "Category": "Bicycle", "Condition": "Good", "Status": "available" },
  { "Id": "e1e1e1e1-0000-0000-0000-000000000002", "InvNumber": "INV-0002", "Category": "Skates", "Condition": "Good", "Status": "available" }
]</code></pre>

      <div class="filename">tariffs.json (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)</div>
      <pre><code class="language-json">[
  { "Id": "f1f1f1f1-0000-0000-0000-000000000001", "Name": "–ß–∞—Å–æ–≤–æ–π", "Mode": "hour", "Rate": 300, "RoundRule": "ceil_30min" },
  { "Id": "f1f1f1f1-0000-0000-0000-000000000002", "Name": "–°—É—Ç–æ—á–Ω—ã–π", "Mode": "day", "Rate": 1200 }
]</code></pre>

      <p class="subtitle">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: GUID‚Äô—ã –º–æ–∂–Ω–æ –Ω–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä—É–∫–∞–º–∏ ‚Äî –∫–æ–¥ –∏—Ö —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç; –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞.</p>
    </section>

    <!-- 4.8 -->
    <section id="ux">
      <h2>4.8. –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

      <h3>–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–±–∞–∑–æ–≤—ã–π –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã ¬´–û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è¬ª)</h3>
      <ul>
        <li>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é: ¬´–°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è¬ª, ¬´–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤¬ª, ¬´–û—Ç–∫—Ä—ã—Ç—å –∞—Ä–µ–Ω–¥—É¬ª, ¬´–ó–∞–∫—Ä—ã—Ç—å –∞—Ä–µ–Ω–¥—É¬ª, ¬´–ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã¬ª, ¬´–í—ã—Ö–æ–¥¬ª.</li>
        <li>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤).</li>
        <li>–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è ¬´–û—Ç–∫—Ä—ã—Ç—å –∞—Ä–µ–Ω–¥—É¬ª –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞/–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å/—Ç–∞—Ä–∏—Ñ; —Å—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ ID.</li>
      </ul>

      <h3>Windows Forms (–≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Å–∏–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤)</h3>
      <ul>
        <li>–í–∫–ª–∞–¥–∫–∏: ¬´–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å¬ª, ¬´–ö–ª–∏–µ–Ω—Ç—ã¬ª, ¬´–ê—Ä–µ–Ω–¥–∞¬ª, ¬´–¢–∞—Ä–∏—Ñ—ã¬ª, ¬´–û—Ç—á—ë—Ç—ã¬ª.</li>
        <li>–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (–∏–∫–æ–Ω–∫–∏/–ø–æ–¥—Å–∫–∞–∑–∫–∏), –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏–π.</li>
        <li>–≠–∫—Å–ø–æ—Ä—Ç CSV –≤ –æ–¥–∏–Ω –∫–ª–∏–∫.</li>
      </ul>
    </section>

    <!-- 4.9 -->
    <section id="quality">
      <h2>4.9. –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞</h2>
      <ul>
        <li>–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ ‚Äî PascalCase –¥–ª—è —Ç–∏–ø–æ–≤/—Å–≤–æ–π—Å—Ç–≤, camelCase –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.</li>
        <li>XML-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø—É–±–ª–∏—á–Ω—ã–º –º–µ—Ç–æ–¥–∞–º; Guard-–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ <code>null</code>/<code>string.Empty</code> –ø—Ä–∏ –≤–≤–æ–¥–µ.</li>
        <li>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π ‚Äî –≤ UI-—Å–ª–æ–µ; –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –Ω–µ ¬´–≥–ª—É—à–∏—Ç—å¬ª.</li>
        <li>–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ (—á–µ—Ä–µ–∑ <span class="mono">.tmp</span>) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.</li>
        <li>–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –ø–æ —Å–ª–æ—è–º: Domain / Services / Utils / UI.</li>
      </ul>
    </section>

    <!-- 4.10 -->
    <section id="demo">
      <h2>4.10. –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
      <p><a href="https://github.com/OlgaKraven/rental-sport-inventory.git">https://github.com/OlgaKraven/rental-sport-inventory.git</a></p>
    </section>


  </div>
</body>
</html>

